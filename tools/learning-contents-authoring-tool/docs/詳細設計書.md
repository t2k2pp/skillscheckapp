# 詳細設計書 - 学習コンテンツ管理ツール

## 1. 概要

本ドキュメントは、「基本設計書」に基づき、「学習コンテンツ管理ツール」の各コンポーネント、API、データ構造に関する詳細な仕様を定義する。

## 2. フロントエンド設計

### 2.1. ディレクトリ構成

```
/components
├── EditorScreen.tsx       # 編集画面全体のコンテナ
├── IndexScreen.tsx        # 一覧画面全体のコンテナ
├── QuestionEditor.tsx     # 個別の問題編集コンポーネント
├── QuizMetadataEditor.tsx # メタデータ編集フォーム
└── icons.tsx              # UIで使用するSVGアイコン
/types
└── ... (プロジェクト共通の型定義)
App.tsx                    # 画面遷移を管理するルートコンポーネント
main.tsx                   # アプリケーションのエントリーポイント
```

### 2.2. 主要コンポーネント仕様

- **`App.tsx`**
  - **責務:** アプリケーションの画面状態（一覧画面か編集画面か）を管理し、適切なコンポーネントを描画するルーターとしての役割を担う。
  - **State:** `view: 'list' | 'edit'`, `currentFile: string | null`

- **`IndexScreen.tsx`**
  - **責務:** コンテンツ一覧の表示と、それに対する操作（編集、削除、新規作成）の起点となる。
  - **Props:** `onEdit: (filename: string) => void`
  - **State:** `questionSets: QuestionSetInfo[]`, `error: string | null`
  - **主要な処理:** マウント時に`/api/question-sets`をフェッチし、一覧を表示する。削除ボタンクリックで、関連APIを呼び出し、コンテンツと画像を削除後、`index.json`を更新する。

- **`EditorScreen.tsx`**
  - **責務:** 一つのコンテンツ（問題セット）の編集機能全体を管理する。
  - **Props:** `filename: string`, `onBack: () => void`
  - **State:** `quizData: Quiz | null`, `error: string | null`, `isNew: boolean`
  - **主要な処理:** マウント時に`/api/question-sets/:filename`からデータを取得する。保存ボタンクリックで、`/api/question-sets/:filename`にデータをPOSTする。新規作成の場合は、`index.json`の更新も行う。

- **`QuizMetadataEditor.tsx`**
  - **責務:** `EditorScreen`の子コンポーネントとして、クイズのメタデータ部分のフォームUIとロジックを提供する。
  - **Props:** `quiz: Quiz`, `onMetadataChange: (field, value) => void`, `isNew?: boolean`
  - **主要な処理:** 画像アップロード処理と、各フォーム入力値の変更を親コンポーネントに通知する。

## 3. バックエンド設計 (API仕様)

- **サーバーファイル:** `server.cjs`
- **ベースURL:** `/api`

| Method | エンドポイント                  | 説明                                   |
|--------|---------------------------------|----------------------------------------|
| `GET`  | `/question-sets`                | `index.json`の内容をすべて取得する。   |
| `POST` | `/question-sets`                | `index.json`の内容を更新する。         |
| `GET`  | `/question-sets/:filename`      | 指定されたファイル名の問題セットJSONを取得する。 |
| `POST` | `/question-sets/:filename`      | 指定されたファイル名で問題セットJSONを保存（作成/更新）する。 |
| `DELETE`| `/question-sets/:filename`      | 指定されたファイル名の問題セットJSONを削除する。 |
| `POST` | `/api/images`                   | サムネイル画像をアップロードする。       |
| `DELETE`| `/api/images/:filename`         | 指定されたファイル名の画像を削除する。   |

## 4. データ構造定義

### 4.1. `config.json`
サーバーが参照するコンテンツディレクトリのパスを定義する。
```json
{
  "questionSetPath": "../../public/question-sets"
}
```

### 4.2. `index.json`
コンテンツ一覧の情報を持つ。
```json
{
  "version": "1.0.0",
  "lastUpdated": "2024-12-19",
  "questionSets": [
    {
      "id": "nodejs",
      "title": "Node.js バックエンドスキルテスト",
      "description": "...",
      "coverImage": "nodejs-logo.png",
      // ... その他のメタデータ
    }
  ]
}
```

### 4.3. `<id>.json` (個別問題セット)
個別の問題セットの詳細データを持つ。
```json
{
  "id": "cpp",
  "title": "C++ コーディングスキルテスト",
  "description": "...",
  "color": "#00599C",
  "coverImage": "cpp-logo.png",
  "questions": [
    {
      "id": 1,
      "level": "beginner",
      "text": "C++で最も基本的な「Hello, World!」を出力するコードはどれですか？",
      "options": ["...", "...", "...", "..."],
      "correctAnswerIndex": 0,
      "explanation": "..."
    }
  ]
}
```
